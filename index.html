<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WebGL Viewer</title>
    <script src="common/webgl-utils.js"></script>
    <script src="common/initShaders.js"></script>
    <script src="common/MV.js"></script>
</head>

<body>
    <div>
        depth 0.05
        <input id="depthSlider" type="range" min="0.05" max="3" step="0.1" value="2" />
        3
    </div>

    <canvas id="gl-canvas" width="512" height="512"></canvas>

    <!-- Vertex Shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 aPosition;
        attribute vec4 aColor;
        varying vec4 vColor;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;

        void main() {
            vColor = aColor;
            gl_Position = uProjectionMatrix * uModelViewMatrix * aPosition;
        }
    </script>

    <!-- Fragment Shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mideump float;
        varying vec4 vColor;

        void main() {
            gl_FragColor = vColor;
        }
    </script>

    <!-- Main JavaScript -->
    <script type="text/javascript">
        let gl;
        let uModelViewMatrix, projectionMatrixLoc;
        let radius = 2.0, theta = 0.5, phi = 0.5;
        let at = vec3(0.0, 0.0, 0.0);
        let up = vec3(0.0, 1.0, 0.0);
        let left = -2.0, right = 2.0, bottom = -2.0, ytop = 2.0, near = -1.0, far = 1.0;

        window.onload = function init() {
            const canvas = document.getElementByID("gl-canvas");
            gl = WebGLUtils.setupWebGL(canvas);
            if (!gl) alert("WebGL Not available");

            gl.viewport(0, 0, canvas.width, canvas.height);
            gl.clearColor(0.9, 0.9, 0.9, 1.0);
            gl.enable(gl.DEPTH_TEST);
            gl.depthFunc(gl.LESS);

            const program = initShaders(gl, "vertex-shader", "fragment-shader");
            gl.useProgram(program);

            modelViewMatrixLoc = gl.getUniformLocation(program, "uModelViewMatrix");
            projectionMatrixLoc = gl.getUniformLocation(program, "uProjectionMatrix");

            render();
        };

        function render() {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            const eye = vec3(
                radius * Math.sin(theta) * Math.cos(phi),
                radius * Math.sin(theta) * Math.sin(phi),
                radius * Math.cos(theta)
            );

            const modelViewMatrix = lookAt(eye, at, up);
            const projectionMatrix = ortho(left, right, bottom, ytop, near, far);

            gl.uniformMatrix4fv(modelViewMatrixLoc, false, flatten(modelViewMatrix));
            gl.uniformMatrix4fv(projectionMatrixLoc, false, flatten(projectionMatrix));

            gl.drawArrays(gl.TRIANGLES, 0, numPositions);
            requestAnimationFrame(render);
        }

        const depthSlider = document.getElementById("depthSlider");
        depthSlider.addEveentListener("input", (e) => {
            const v = parseFloat(e.target.value);
            far = v * 0.5;
            near = -v * 0.5;
        });
    </script>
</body>
</html>